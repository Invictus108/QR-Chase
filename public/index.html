<!DOCTYPE html>
<html>
    <head>
      <title>Lobby</title>
      <script src="/socket.io/socket.io.js"></script>
    </head>
    <body>
      <input type="text" id="username" placeholder="Username" required>
      <form id="join">
        <input type="text" id="room" placeholder="Join Existing Room" required>
        <input type="submit">
      </form>
        
      <form id="create">
        <select name="gamemode" id="gamemode" multiple>
          <option value="normal">Normal</option>
        </select>
        <input type="text" id="created-room" placeholder="Create Room">
        <input type="submit">
      </form>
      
    </body>

  <script>
    var socket = io();

    document.cookie = 'username=; room=;';

    const join  = document.getElementById("join")
    const create = document.getElementById("create")

    function setCookie(name, value, days) {
      const expires = new Date();
      expires.setTime(expires.getTime() + days * 60 * 60 * 1000);
      document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/`;
    }

    join.addEventListener("submit", (e) => {
      e.preventDefault();
      const room = document.getElementById("room").value
      const username = document.getElementById("username").value

      if (!room) return alert('Please input a Room ID')
      else if (!username) return alert('Please input a Username')

      socket.emit("join-room", {
        room: room,
        username: username
      })
      
      socket.on("room-joined", (msg) => {
        if(msg.worked){ 
          setCookie("username", username, 1);
          setCookie("room", room, 1);
          console.log("Joined")
          window.location.replace(`index2.html`);
        }
        else {
          alert("Invalid Game ID")
        }
        
      })
      
    })

    create.addEventListener( "submit", (e) => {
      e.preventDefault();
      console.log("Create Room")
      const mode = document.getElementById("gamemode").value
      const newRoom = document.getElementById("created-room").value
      const username = document.getElementById("username").value

      if (!newRoom) return alert('Please input a Room ID')
      else if (!username) return alert('Please input a Username')

      socket.emit("create-room", {
        mode: mode,
        room: newRoom,
        username: username
      })
      
      socket.on("room-created", (room) => {
        if(room.worked){
          console.log("created")
          if (username && newRoom) {
          setCookie("username", username, 1);
          setCookie("room", newRoom, 1);
          } else {
            console.error('Unable to get some fields.')
            console.log(`Username: ${username} | Room: ${newRoom}`)
          }

          window.location.replace(`index2.html`);
        }
        else {
          alert("Something went wrong")
        }
        
       
      })
      
    })
    
    
  </script>
</html>