<!DOCTYPE html>
<html>
    <head>
      <title>Lobby</title>
      <script src="/socket.io/socket.io.js"></script>
    </head>
    <body>
      <input type="text" id="username" placeholder="username" required>
      <form id="join">
        <input type="text" id="room" placeholder="Room ID" required>
        <input type="submit">
      </form>
        
      <form id="create">
        <select name="gamemode" id="gamemode" multiple>
          <option value="normal">Normal</option>
        </select>
        <input type="text" id="name" placeholder="Name">
        <input type="submit">
      </form>
      
    </body>

  <script>
    var socket = io();

    document.cookie = 'username=; room=;';

    let join  = document.getElementById("join")
    let create = document.getElementById("create")
    let username;

    function setCookie(name, value, days) {
      const expires = new Date();
      expires.setTime(expires.getTime() + days * 60 * 60 * 1000);
      document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/`;
    }

    

    join.addEventListener("submit", (e) => {
      e.preventDefault();
       let room = document.getElementById("room").value
      username = document.getElementById("username").value
      socket.emit("join-room", {
        room: room,
        username: username
      })
      
      socket.on("room-joined", (msg) => {
        if(msg.worked){ 
          setCookie("username", username, 1);
          setCookie("room", room, 1);
          console.log("Joined")
          window.location.replace(`index2.html`);
        }
        else {
          alert("Invalid Game ID")
        }
        
      })
      
    })

    create.addEventListener( "submit", (e) => {
      e.preventDefault();
      console.log("Create Room")
      let mode = document.getElementById("gamemode").value
      let name = document.getElementById("name").value
      username = document.getElementById("username").value

      socket.emit("create-room", {
        mode: mode,
        room: name,
        username: username
      })
      
      socket.on("room-created", (room) => {
        if(room.worked){
          console.log("created")
          if (username && name) {
          setCookie("username", username, 1);
          setCookie("room", name, 1);
          } else {
            console.error('Unable to get some fields.')
            console.log(`Username: ${username} | Room: ${name}`)
          }

          window.location.replace(`index2.html`);
        }
        else {
          alert("Something went wrong")
        }
        
       
      })
      
    })
    
    
  </script>
</html>